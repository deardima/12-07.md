# Домашнее Задание к занятию «Репликация и масштабирование. Часть 2»
## Косарев Д.О.

---

## **Задание 1: Преимущества различных конфигураций репликации**

### **1. Один главный (Master) и один запасной (Slave) сервер**

- **Надёжность (High Availability):** Если основной сервер выйдет из строя, запасной сервер мгновенно заменит его. Это минимизирует простой приложения.
- **Разделение нагрузки на чтение:** Запасной сервер можно использовать для выполнения запросов на чтение (например, отчёты, аналитика), что снижает нагрузку на главный сервер.
- **Безопасность бэкапов:** На slave-сервере можно безопасно создавать резервные копии данных, не влияя на производительность основной базы.
- **Простота:** Архитектура проста в понимании, настройке и поддержке.

### **2. Один главный (Master) и несколько подчинённых (Slave) серверов**

- **Масштабирование операций чтения:** Основное преимущество. Нагрузка от запросов `SELECT` распределяется между несколькими slave-серверами, что значительно повышает общую производительность и пропускную способность системы.
- **Повышенная отказоустойчивость:** При отказе одного из slave-серверов остальные продолжают обслуживать запросы. Сохраняется и защита от падения master-сервера.
- **Гибкость в использовании:** Разные slave-серверы можно специализировать:
  - Один — для веб-приложения.
  - Другой — для внутренней отчётности.
  - Третий — для географически распределённых пользователей (снижение задержки).

---

## **Задание 2: План горизонтального и вертикального шардинга**

### **Краткое описание подходов**

| Подход | Суть | Аналогия | Главная цель |
| :--- | :--- | :--- | :--- |
| **Горизонтальный шардинг** | Разделение **одной таблицы** на части с одинаковой структурой по **строкам**. | Разрезать книгу-справочник на тома (А-К, Л-Я). | Удержать огромный объем данных в одной логической таблице. |
| **Вертикальный шардинг** | Разделение данных **между разными таблицами или даже столбцами** одной таблицы. | Разложить товары по разным складам (склад одежды, склад электроники). | Изолировать нагрузку, разделить данные по смыслу, оптимизировать хранилище. |

### **План разбивки для базы (пользователи, книги, магазины)**

**1. Вертикальный шардинг (первый этап — разделим по смыслу):**
- **Сервер БД-1 (Пользовательский):** Хранит таблицу `пользователи` и связанные с ней данные (логины, профили).
- **Сервер БД-2 (Каталог):** Хранит таблицу `книги` и связанные данные (авторы, жанры).
- **Сервер БД-3 (Операционный):** Хранит таблицу `магазины` и связанные данные (заказы, транзакции, остатки).

**2. Горизонтальный шардинг (второй этап — разрежем большие таблицы):**
- На **Сервере БД-1** таблицу `пользователи` делим на шарды по диапазону `user_id` (например, по миллиону записей на шард).
- На **Сервере БД-2** аналогично делим таблицу `книги` по `book_id`.
- Таблицу `магазины` обычно не шардят из-за небольшого объема.

### **Схема архитектуры (комбинированный подход)**

```mermaid
graph TD
    A[Веб-приложение] --> B[Координатор]
    
    B --> C[Группа ПОЛЬЗОВАТЕЛИ]
    B --> D[Группа КНИГИ]
    B --> E[Группа МАГАЗИНЫ]
    
    C --> F[Шард 1]
    C --> G[Шард 2]
    C --> H[...]
    
    D --> I[Шард A]
    D --> J[Шард B]
    D --> K[...]
    
    E --> L[Сервер 3]
    
    F --> M[Master]
    F --> N[Slave 1]
    F --> O[Slave 2]
    
    style M fill:#90EE90
    style N fill:#ADD8E6
    style O fill:#ADD8E6
Режимы работы серверов базы данных
Каждый физический сервер БД (шард) работает в связке Master-Slave:

Master (Ведущий сервер):

Единственный, кто принимает все операции записи (INSERT, UPDATE, DELETE) для своего шарда.

Является источником истины для данных своего фрагмента.

Slave (Ведомый сервер, один или несколько):

Постоянно копирует данные с Master через механизм репликации.

Обслуживает все операции чтения (SELECT) со своего шарда.

Используется для масштабирования чтения и в качестве "горячего" резерва.

Процесс восстановления (Failover): В случае падения Master один из Slave автоматически или вручную становится новым Master.
